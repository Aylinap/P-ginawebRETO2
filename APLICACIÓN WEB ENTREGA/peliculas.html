<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Aqui pagina responsiva-->
    <link rel="stylesheet" href="style.css"> <!-- Enlace que se liga al css para editar la pagina web-->
    <link rel="icon" type="image/jpg" href="img/logocineusurbil.png"> <!-- icono de la pagina -->
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Open+Sans:wght@400;600&display=swap"
        rel="stylesheet"> <!-- fuente que use para el logo y los titulos, extraida desde google font-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <!-- pagina que use para agregar iconos a nuestra pagina web -->
    <script src="https://kit.fontawesome.com/9845d1980a.js" crossorigin="anonymous"></script>
    <!-- JS-->
    <script src="peliculas.js"></script>
    <title>Cine Usurbil|Películas</title>
</head>

<body>
    <!-- Barra de navegación y header -->
    <header>

        <!--Se verá solo en pantallas grandes-->
        <div class="container-grande">
            <div class="logo-container">
                <img src="img/logocineusurbil.png" alt="Cine Usurbil Logo">
                <h2 class="logotipo">Cine Usurbil</h2>
            </div>

            <nav>
                <div class="menu-item">
                    <a href="./index.html" target="_blank">Estrenos</a>
                </div>
                <div class="menu-item">
                    <input type="checkbox" id="genero-grande">
                    <label for="genero-grande" class="bot-genero activo">Películas</label>
                    <div class="dropdown-genero">
                        <div class="genero-item">
                            <a target="" onclick="filterByGenre(27)">Terror (Horror)</a>
                        </div>
                        <div class="genero-item">
                            <a target="" onclick="filterByGenre(18)">Drama</a>
                        </div>
                        <div class="genero-item">
                            <a target="" onclick="filterByGenre(35)">Comedia</a>
                        </div>
                        <div class="genero-item">
                            <a target="" onclick="filterByGenre(878)">Sci - Fi</a>
                        </div>
                    </div>
                </div>
                <div class="menu-item">
                    <a href="./cines.html" target="">Cines</a>
                </div>
                <div class="menu-item">
                    <a href="./pagtickets.html" target="">Tickets</a>
                </div>
                <div class="menu-item">
                    <a href="./index.html" target="">Login || Sign in</a>
                </div>
            </nav>
        </div>

        <!--Se verá solo en pantallas de móvil-->
        <div class="container-movil">
            <div class="logo-container">
                <img src="img/logocineusurbil.png" alt="Cine Usurbil Logo">
                <h2 class="logotipo">Cine Usurbil</h2>
            </div>

            <nav>
                <input type="checkbox" id="menu">
                <label for="menu" class="bot-submenu"> ☰ </label>
                <div class="dropdown-menu">
                    <div class="menu-item">
                        <a href="./index.html" target="_blank">Estrenos</a>
                    </div>
                    <div class="menu-item">
                        <span class="">Películas</span>
                        <input type="checkbox" id="genero">
                        <label for="genero" class="bot-genero"> ☰ </label>
                        <div class="dropdown-genero">
                            <div class="genero-item">
                                <a href="./pagterror.html" target="_blank">Terror</a>
                            </div>
                            <div class="genero-item">
                                <a href="./pagdrama.html" target="_blank">Drama</a>
                            </div>
                            <div class="genero-item">
                                <a href="./pagcomedia.html" target="_blank">Comedia</a>
                            </div>
                            <div class="genero-item">
                                <a href="./pagscifi.html" target="_blank">Sci - Fi</a>
                            </div>
                        </div>
                    </div>
                    <div class="menu-item">
                        <a href="./cines.html" target="_blank" id="activo">Cines</a>
                    </div>
                    <div class="menu-item">
                        <a href="./pagtickets.html" target="_blank">Tickets</a>
                    </div>
                    <div class="menu-item">
                        <a href="./index.html" target="_blank">Login || Sign in</a>
                    </div>
                </div>
            </nav>
        </div>
    </header>
    <!-- AQUI VA LOS CONTENIDOS VACIOS Y YO VOY CARGANDO LA INFORMACION CON JAVASCRIPT TOMANDO LOS ELEMENTOS
        CON GETELEMENTID Y LUEGO AGREGANDO CON UN FOR LOS ITEMS O INFO QUE QUIERO PASAR.    
        Tambien puedo tomar toda la info desde la API -->

    <!-- los fondos tambien puedo hacerlos con jvs que vaya cargando cuando se cargue la pagina -->

    <!-- Aqui esta la base del html que se va a ir repitiendo por cada pelicula en total 4 peliculas por pagina.
             4 paginas por genero: Terror, ciencia fiction, drama, comedia.
            hacerlo cargar con js las paginas dependiendo que es lo que elija la persona -->

    <main id="peliculas-div">
        <!-- Pelicula Principal-->
        <div class="principal" id="pagterror">
            <div class="contenedor">
                <h1 class="titulo">Drácula de Bram Stoker</h1>
                <h3>
                    Antes de convertirse en vampiro, el conde Drácula era el príncipe Vlad, quien tras conocer la muerte
                    de su prometida, vendió su alma al diablo.
                    Cuatro siglos después, en Londres, encuentra a Mina, reencarnación de su amor perdido.
                </h3>
                <div class="botones">
                    <button class="boton"><i class="fa-solid fa-ticket"></i>¡Compra ya tus entradas!</button>
                    <button class="boton"><i class="fas fa-info-circle"></i>Más información</button>
                </div>
            </div>
        </div>
        <div class="titulo">
            <h1>Los más vistos</h1>
        </div>

    </main>

    <script>

        // a ver si me funciona la api de tmdB 
            

            // intento de hacer fetch await con el TMDB.( la pagina no lo trae pero a ver si funciona.)
            // funciona super bien la API DE TMBD. EN ESPAÑOL, podria pasar toda la pagina web usando api
            // GENEROS ID TMBD: https://www.themoviedb.org/talk/5daf6eb0ae36680011d7e6ee
            // EL TEMA ES QUE SON LAS PELICULAS POPULARES---> me sirve para proximos estrenos.
            // necesito ver como sacar las imagenes porque estan en un jpg pero no se de donde los sacaran
            // ya encontre la solucion, https://www.themoviedb.org/talk/5aeaaf56c3a3682ddf0010de
            // esta seria la ruta entera: https://image.tmdb.org/t/p/original/jXJxMcVoEuXzym3vFnjqDW4ifo6.jpg
            // esta seria la ruta sola sin https://image.tmdb.org/t/p/original(supongo que va cambiando la id o cosas asi en la informacion o la ruta o etc?) supongo que yo me entiendo.
            
        
        async function fetchPopularMovies() {
            const url = 'https://api.themoviedb.org/3/movie/popular?language=es-ES&page=1';
            const options = {
                method: 'GET',
                headers: {
                    accept: 'application/json',
                    Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJhYzgyZDhhODFkYjgzYTNjNDUwNjIxNDkzMzVmNGZjMCIsInN1YiI6IjY1YmI2ODFjZjAzMTc0MDE3YzY3OWQ2NSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.Tv7XQu-LlSPMXh1-0uNmH14X0w-L7hZuZVPd4xOsUVk'
                }
            };

            try {
                const response = await fetch(url, options);
                const data = await response.json();
                console.log(data);

                renderMovies(data.results);
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function filterByGenre(genre_id) {
            const url = `https://api.themoviedb.org/3/discover/movie?language=es-ES&with_genres=${genre_id}&sort_by=popularity.desc`;
            const options = {
                method: 'GET',
                headers: {
                    accept: 'application/json',
                    Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJhYzgyZDhhODFkYjgzYTNjNDUwNjIxNDkzMzVmNGZjMCIsInN1YiI6IjY1YmI2ODFjZjAzMTc0MDE3YzY3OWQ2NSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.Tv7XQu-LlSPMXh1-0uNmH14X0w-L7hZuZVPd4xOsUVk'
                }
            };

            try {
                const response = await fetch(url, options);
                const data = await response.json();
                console.log(data);

                const filteredMovies = data.results.filter(movie => movie.genre_ids.includes(genre_id));

                console.log(filteredMovies.slice(0, 10));
                renderMovies(filteredMovies.slice(0, 10));
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function getGenreByID(id) {
            // Diccionarrio:
            // Llave: valor
            const genres = {
                28: "Action",
                12: "Adventure",
                16: "Animation",
                35: "Comedy",
                80: "Crime",
                99: "Documentary",
                18: "Drama",
                10751: "Family",
                14: "Fantasy",
                36: "History",
                27: "Horror",
                10402: "Music",
                9648: "Mystery",
                10749: "Romance",
                878: "Science Fiction",
                10770: "TV Movie",
                53: "Thriller",
                10752: "War",
                37: "Western"
            };

            return genres[id]; // le doy un id como llave y me da un genero como valor

        }

        function getClasification(isAdult) {
            if (isAdult) {
                return "Apto para mayores de 18";
            }

            return "Apto para todo público";
        }

        function createMovieElement(movie) {
            const peliculaContainer = document.createElement("div");
            peliculaContainer.className = "peliculas-container";

            const peliculaMini = document.createElement("div");
            peliculaMini.className = "pelicula-mini";

            const caratula = document.createElement("div");
            caratula.className = "caratula";
            const imagen = document.createElement("img");
            imagen.src = `https://image.tmdb.org/t/p/original${movie.poster_path}`;
            imagen.alt = `Carátula de la película ${movie.title}`;
            caratula.appendChild(imagen);

            const containerBoton = document.createElement("div");
            containerBoton.className = "container-buttom";
            const form = document.createElement("form");
            const botonTrailer = document.createElement("button");
            botonTrailer.setAttribute("formaction", "https://youtu.be/");
            botonTrailer.setAttribute("formtarget", "_blank");
            botonTrailer.innerHTML = `<i class="fa-regular fa-circle-play" style="color: #fcfcfc;"></i> Trailer`;
            form.appendChild(botonTrailer);
            containerBoton.appendChild(form);

            const containerResumen = document.createElement("div");
            containerResumen.className = "container-resumen width-100";
            const resumen = document.createElement("div");
            resumen.className = "resumen";
            resumen.innerHTML = `<h2>${movie.title} (${movie.release_date.split("-")[0]})</h2>
            <br>
            <p>${movie.overview}</p>`;
            const duracionTicket = document.createElement("div");
            duracionTicket.className = "duracion-ticket";
            const duracion = document.createElement("div");
            duracion.className = "duracion";
            duracion.innerHTML = "<br>";

            const duracionTiempo = document.createElement("h3");
            duracionTiempo.innerHTML = "Duración: X";

            const duracionEdad = document.createElement("h3");
            duracionEdad.innerHTML = `${getClasification(movie.adult)}`;

            //duracion.appendChild(duracionTiempo);

            const generosPelicula = movie.genre_ids;
            generosPelicula.forEach(genero => {
                const generoBox = document.createElement("div");
                generoBox.className = "borde-genero";
                generoBox.innerHTML = `<h4>${getGenreByID(genero)}</h4>`;
                duracion.appendChild(generoBox);
            });

            duracion.appendChild(duracionEdad);

            const mainSection = document.createElement("div");
            mainSection.className = "main-section";
            const firstButton = document.createElement("button");
            firstButton.className = "first-button";
            firstButton.innerHTML = `¡ Tickets ! <i class="fa-solid fa-ticket"></i>`;
            const secondButton = document.createElement("button");
            secondButton.className = "second-button";
            secondButton.innerHTML = `<svg viewBox="0 0 24 24" width="20" height="20" stroke="#ffd300" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg> Compra Ahora!`;

            // Agregar elementos al contenedor principal
            const caratulaDiv = document.createElement("div");
            caratulaDiv.appendChild(caratula);
            caratulaDiv.appendChild(containerBoton);

            peliculaMini.appendChild(caratulaDiv);
            peliculaMini.appendChild(containerResumen);
            resumen.appendChild(duracionTicket);
            duracionTicket.appendChild(duracion);
            duracionTicket.appendChild(mainSection);
            mainSection.appendChild(firstButton);
            mainSection.appendChild(secondButton);
            containerResumen.appendChild(resumen);

            peliculaContainer.appendChild(peliculaMini);

            const peliculaDiv = document.createElement("div");
            peliculaDiv.className = "width-100";
            peliculaDiv.appendChild(peliculaContainer);

            return peliculaDiv;
        }

        function renderMovies(movies) {
            const peliculasContainer = document.getElementById("peliculas-div");

            // Default
            peliculasContainer.innerHTML = `<!-- Pelicula Principal-->
        <div class="principal" id="pagterror">
            <div class="contenedor">
                <h1 class="titulo">Drácula de Bram Stoker</h1>
                <h3>
                    Antes de convertirse en vampiro, el conde Drácula era el príncipe Vlad, quien tras conocer la muerte
                    de su prometida, vendió su alma al diablo.
                    Cuatro siglos después, en Londres, encuentra a Mina, reencarnación de su amor perdido.
                </h3>
                <div class="botones">
                    <button class="boton"><i class="fa-solid fa-ticket"></i>¡Compra ya tus entradas!</button>
                    <button class="boton"><i class="fas fa-info-circle"></i>Más información</button>
                </div>
            </div>
        </div>
        <div class="titulo">
            <h1>Los más vistos</h1>
        </div>`;
            
            // COMO USAR EL FOR EACH: 
            // ARREGLO.PorCadaElemento( variable_de_iteracion(nombre que le di)
            // => { hacer algo})
            movies.forEach(movie => {
                const movieElement = createMovieElement(movie);
                peliculasContainer.appendChild(movieElement);
            });
        }

        document.addEventListener("DOMContentLoaded", fetchPopularMovies);


    </script>





    <!-- Footer de la página-->
    <footer>
        <div class="footer-container">
            <div class="footer-column">
                <a href="./pagcineinfo.html" target="_blank"><i class="fa-solid fa-film"></i>Quiénes somos</a>
                <a href="./pagcineinfo.html" target="_blank"><i class="fa-solid fa-location-dot"></i>Cómo llegar</a>
                <a href="./pagcineinfo.html" target="_blank"><i class="fa-solid fa-circle-info"></i>Atención
                    al cliente</a>
                <a href="./pagcineinfo.html" target="_blank"><i class="fa-solid fa-phone"></i> +34 606 060 6060</a>
            </div>
            <div class="footer-column">
                <p><i class="fa-solid fa-address-card"></i> ¿Eres socio?</p>
                <p>Conoce nuestros beneficios por ser socio del club</p>
                <p>Cine Usurbil</p>
                <div class="rrss"> <!-- Iconos del footer -->
                    <a><i class="fa-brands fa-instagram"></i></a>
                    <a><i class="fa-brands fa-facebook"></i></a>
                    <a><i class="fa-brands fa-youtube"></i></a>
                    <a><i class="fa-brands fa-tiktok"></i></a>
                </div>
            </div>
            <div class="footer-column">
                <a href="#">Aviso legal</a>
                <a href="#">Política de privacidad</a>
                <a href="#">Términos y condiciones</a>
                <a href="http://creativecommons.org/licenses/by-nd/4.0/?ref=chooser-v1" target="_blank"
                    rel="license noopener noreferrer" style="display:inline-block;"><img
                        style="height:22px!important;margin-left:3px;vertical-align:text-bottom;"
                        src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"
                        alt="licencia"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;"
                        src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"
                        alt="licencia"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;"
                        src="https://mirrors.creativecommons.org/presskit/icons/nd.svg?ref=chooser-v1"
                        alt="licencia"></a>
            </div>
        </div>
    </footer>
</body>

</html>