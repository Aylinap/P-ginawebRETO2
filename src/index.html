<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Aqui pagina responsiva-->
    <link rel="stylesheet" href="style.css"> <!-- Enlace que se liga al css para editar la pagina web-->
    <link rel="icon" type="image/jpg" href="img/logocineusurbil.png"> <!-- icono de la pagina -->
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Open+Sans:wght@400;600&display=swap"
        rel="stylesheet"> <!-- fuente que use para el logo y los titulos, extraida desde google font-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <!-- JS-->
    <!--<script src="peliculas.js"></script> -->
    <!-- pagina que use para agregar iconos a nuestra pagina web -->
    <title>Cine Usurbil|Películas</title>
</head>

<body>

    <!-- Barra de navegación y header -->
    <header>

        <!--Se verá solo en pantallas grandes-->
        <div class="container-grande">
            <div class="logo-container">
                <img src="img/logocineusurbil.png" alt="Cine Usurbil Logo">
                <h2 class="logotipo">Cine Usurbil</h2>
            </div>

            <nav>
                <div class="menu-item">
                    <a href="./index.html" target="" class="activo">Estrenos</a>
                </div>
                <div class="menu-item">
                    <input type="checkbox" id="genero-grande">
                    <label for="genero-grande" class="bot-genero">Películas</label>
                    <div class="dropdown-genero">
                        <div class="genero-item">
                            <a target="" onclick="filterByGenre(27)">Terror (Horror)</a>
                        </div>
                        <div class="genero-item">
                            <a target="" onclick="filterByGenre(18)">Drama</a>
                        </div>
                        <div class="genero-item">
                            <a target="" onclick="filterByGenre(35)">Comedia</a>
                        </div>
                        <div class="genero-item">
                            <a target="" onclick="filterByGenre(878)">Sci - Fi</a>
                        </div>
                    </div>
                </div>
                <div class="menu-item">
                    <a href="./cines.html" target="">Cines</a>
                </div>
                <div class="menu-item">
                    <a href="./pagtickets.html" target="">Tickets</a>
                </div>
                <div class="menu-item">
                    <a href="./index.html" target="">Iniciar sesión</a>
                </div>
            </nav>
        </div>

        <!--Se verá solo en pantallas de móvil-->
        <div class="container-movil">
            <div class="logo-container">
                <img src="img/logocineusurbil.png" alt="Cine Usurbil Logo">
                <h2 class="logotipo">Cine Usurbil</h2>
            </div>

            <nav>
                <input type="checkbox" id="menu">
                <label for="menu" class="bot-submenu"> ☰ </label>
                <div class="dropdown-menu">
                    <div class="menu-item">
                        <a href="./index.html" target="" class="activo">Estrenos</a>
                    </div>
                    <div class="menu-item">
                        <span>Películas</span>
                        <input type="checkbox" id="genero">
                        <label for="genero" class="bot-genero"> ▼ </label>
                        <div class="dropdown-genero">
                            <div class="genero-item">
                                <a target="" onclick="filterByGenre(27)">Terror (Horror)</a>
                            </div>
                            <div class="genero-item">
                                <a target="" onclick="filterByGenre(18)">Drama</a>
                            </div>
                            <div class="genero-item">
                                <a target="" onclick="filterByGenre(35)">Comedia</a>
                            </div>
                            <div class="genero-item">
                                <a target="" onclick="filterByGenre(878)">Sci - Fi</a>
                            </div>
                        </div>
                    </div>
                    <div class="menu-item">
                        <a href="./cines.html" target="">Cines</a>
                    </div>
                    <div class="menu-item">
                        <a href="./pagtickets.html" target="">Tickets</a>
                    </div>
                    <div class="menu-item">
                        <a href="./index.html" target="">Iniciar sesión</a>
                    </div>
                </div>
            </nav>
        </div> <!--<div class="menu-item">
                    <a href="./index.html" target="_blank" class="">Tickets</a>
                </div>
                <div class="menu-item">
                    <input type="checkbox" id="buscar">
                    <label for="buscar" class="bot-buscar"><i class="fa-solid fa-magnifying-glass"></i></label>
                    <div class="buscar-item">
                        <input type="text" placeholder="Buscar...">
                    </div>
                </div>-->
    </header>

    <main id="main-estrenos">
        <script>
            async function fetchPopularMovies() {
                const url = 'https://api.themoviedb.org/3/movie/popular?language=es-ES&page=1';
                const options = {
                    method: 'GET',
                    headers: {
                        accept: 'application/json',
                        Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJhYzgyZDhhODFkYjgzYTNjNDUwNjIxNDkzMzVmNGZjMCIsInN1YiI6IjY1YmI2ODFjZjAzMTc0MDE3YzY3OWQ2NSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.Tv7XQu-LlSPMXh1-0uNmH14X0w-L7hZuZVPd4xOsUVk'
                    }
                };

                try {
                    const response = await fetch(url, options);
                    const data = await response.json();
                    console.log(data);


                    createIndex(data.results);
                } catch (error) {
                    console.error('Error:', error);
                }
            }
            // filtrar peliculas por genero, pasar parametro genero-id
            async function filterByGenre(genre_id) {
                const url = `https://api.themoviedb.org/3/discover/movie?language=es-ES&with_genres=${genre_id}&sort_by=popularity.desc`;
                const options = {
                    method: 'GET',
                    headers: {
                        accept: 'application/json',
                        Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJhYzgyZDhhODFkYjgzYTNjNDUwNjIxNDkzMzVmNGZjMCIsInN1YiI6IjY1YmI2ODFjZjAzMTc0MDE3YzY3OWQ2NSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.Tv7XQu-LlSPMXh1-0uNmH14X0w-L7hZuZVPd4xOsUVk'
                    }
                };

                try {
                    const response = await fetch(url, options);
                    const data = await response.json();
                    console.log(data);

                    /*: filtra las películas según si el genre_id especificado está incluido en el array genre_ids de cada película.
                     El resultado se almacena en la variable filteredMovies
                     includes es una funcion/libreria de JS e igual FILTER/filtrar.*/
                    const filteredMovies = data.results.filter(movie => movie.genre_ids.includes(genre_id));

                    const backgroundImageUrl = data.backdrop_path;


                    // filtrar,(retornar la copia de un arreglo desde el indice del inicio hasta el penúltimo final, excluyendo el final)
                    // esta filtrando cuando se elige el género en el menú y se filtra por consola
                    console.log(filteredMovies.slice(0, 10));
                    renderMovies(filteredMovies.slice(0, 10));
                } catch (error) {
                    console.error('Error:', error);
                }
            }

            // funcion diccionario para saber cuales son los generos usando los id de la api
            function getGenreByID(id) {
                // Diccionarrio (en js):
                // Llave: valor
                const genres = {
                    28: "Acción",
                    12: "Aventura",
                    16: "Animación",
                    35: "Comedia",
                    80: "Crimen",
                    99: "Documental",
                    18: "Drama",
                    10751: "Familia",
                    14: "Fantasía",
                    36: "Historia",
                    27: "Terror",
                    10402: "Música",
                    9648: "Misterio",
                    10749: "Romance",
                    878: "Ciencia Ficción",
                    10770: "Película de TV",
                    53: "Thriller",
                    10752: "Guerra",
                    37: "Western"

                };

                return genres[id]; // le doy un id como llave y me da un genero como valor

            }

            // funcion crear tarjetas
            function createCARDS(movie) {
                const containerPelis = document.createElement("div");
                containerPelis.className = "container-cards width-100";

                const tituloGenero = document.createElement("div");
                tituloGenero.className = "titulo";
                const h1titulogenero = document.createElement("h1");
                h1titulogenero.textContent = "Los más vistos en: " + getGenreByID(movie.genre_ids[0]); // Solo toma el primer género por simplicidad
                tituloGenero.appendChild(h1titulogenero);
                containerPelis.appendChild(tituloGenero);

                const containerCard = document.createElement("div");
                containerCard.className = "contenedor";

                const card = document.createElement("div");
                card.className = "carta";

                const cardImg = document.createElement("img");
                cardImg.src = `https://image.tmdb.org/t/p/original${movie.poster_path}`;
                cardImg.alt = `Carátula de la película ${movie.title}`;
                card.appendChild(cardImg);

                const description = document.createElement("div");
                description.className = "descripcion";
                description.innerHTML = `<h3>${movie.title}</h3><br><p>Género: ${getGenreByID(movie.genre_ids[0])}</p>`;
                card.appendChild(description);

                containerCard.appendChild(card);
                containerPelis.appendChild(containerCard);

                return containerPelis;
            }


            //funcion crear el index
            function createIndex(imagenes) {
                const imagengrid = document.getElementById("main-estrenos");
                console.log(imagengrid);
                imagengrid.innerHTML = "";

                const peliculaPrincipal = document.createElement("div");
                peliculaPrincipal.className = "principal";
                peliculaPrincipal.id = "pagterror";// mantendre el id (ver si lo uso)

                const contenedorPrincipal = document.createElement("div");
                contenedorPrincipal.className = "contenedor";

                const tituloPrincipal = document.createElement("h1");
                tituloPrincipal.className = "titulo";
                tituloPrincipal.innerText = imagenes[18].title;// solo ocupare la primera posicion de la lista (pelicula)
                tituloPrincipal.style.color = "black";

                const descripcionPrincipal = document.createElement("h3");
                descripcionPrincipal.innerHTML = imagenes[18].overview;// solo ocupare la primera posicion de la descripcion
                descripcionPrincipal.style.color = "black";


                // crear los botones que van dentro( sin funcionalidad)
                const botonesPrincipal = document.createElement("div");
                botonesPrincipal.className = "botones";

                // con innerTEXT no me agregaba los iconos sino el codigo. tuve que utilizar innerHTML.
                // --> https://www.freecodecamp.org/news/innerhtml-vs-innertext-vs-textcontent/

                contenedorPrincipal.appendChild(tituloPrincipal);
                contenedorPrincipal.appendChild(descripcionPrincipal);
                peliculaPrincipal.appendChild(contenedorPrincipal);
                imagengrid.appendChild(peliculaPrincipal);

                // para manejar el CSS desde el JS se le ponge.style.
                peliculaPrincipal.style.backgroundImage = `url('https://image.tmdb.org/t/p/original${imagenes[18].backdrop_path}')`;

                // el titulo de cada pagina( me falta poder asignarle el genero. solo si puedo sino no )
                const tituloMasVistos = document.createElement("div");
                tituloMasVistos.className = "titulo";
                const h1MasVistos = document.createElement("h1");
                h1MasVistos.textContent = " ! Próximos estrenos !";
                tituloMasVistos.appendChild(h1MasVistos);
                imagengrid.appendChild(tituloMasVistos);


                // aqui empieza el grid
                const container_grid = document.createElement("div");
                container_grid.className = "container-img";

                imagenes.slice(12, 19).forEach(imagen => {


                    const boxImg = document.createElement("div");
                    boxImg.className = "box-img";
                    const figure1 = document.createElement("figure");
                    figure1.className = "width-100";
                    const img = document.createElement("img");
                    img.className = "width-100";
                    img.src = `https://image.tmdb.org/t/p/original${imagen.backdrop_path}`; // como ejemplo.
                    img.alt = `Carátula de la película ${imagen.title}`;

                    figure1.appendChild(img);
                    boxImg.appendChild(figure1);
                    container_grid.appendChild(boxImg);
                    // ver si realmente me funciona asi 
                });

                // aqui podria hacer un for que me inserte cada pelicula CARTA. como en html
                imagengrid.appendChild(container_grid);
                console.log("Grid de imágenes agregado al DOM");


                imagenes.forEach(movie => {
                    const movieCard = createCARDS(movie);
                    imagengrid.appendChild(movieCard);
                });
                console.log("Tarjetas de películas agregadas al DOM");

                //default ( funcion para insertar al final del dom el elemento desde js)
                imagengrid.insertAdjacentHTML('beforeend',`
                <div class="apartado3">
                    <div class="titulo">
                        <h1>¿ NO ERES PARTE DEL CLUB DE SOCIOS ?</h1>
                    </div>
                    <div class="texto">
                        <h2>¡Únete al Club de Socios Cine Usurbil y Descubre un Mundo de Experiencias Cinematográficas
                            Exclusivas!</h2>
                        <h2>En Cine Usurbil, valoramos a nuestros apasionados amantes del cine, y para mostrar nuestro
                            agradecimiento, hemos creado el Club de Socios Cine Usurbil, un espacio exclusivo dedicado a
                            brindarte experiencias únicas y beneficios especiales.</h2>
                    </div>
                    <div>
                        <div class="imagen">
                            <img src="img/postersocios.png" alt="Imagen Socios" title="Cine Usurbil">
                        </div>
                    </div>
                </div>`);
            }

            document.addEventListener("DOMContentLoaded", fetchPopularMovies);
        </script>
    </main>

    <!-- Footer de la página-->
    <footer>
        <div class="footer-container">
            <div class="footer-column">
                <a href="./pagcineinfo.html" target="_blank"><i class="fa-solid fa-film"></i>Quiénes somos</a>
                <a href="./pagcineinfo.html" target="_blank"><i class="fa-solid fa-location-dot"></i>Cómo llegar</a>
                <a href="./pagcineinfo.html" target="_blank"><i class="fa-solid fa-circle-info"></i>Atención
                    al cliente</a>
                <a href="./pagcineinfo.html" target="_blank"><i class="fa-solid fa-phone"></i> +34 606 060 6060</a>
            </div>
            <div class="footer-column">
                <p><i class="fa-solid fa-address-card"></i> ¿Eres socio?</p>
                <p>Conoce nuestros beneficios por ser socio del club</p>
                <p>Cine Usurbil</p>
                <div class="rrss"> <!-- Iconos del footer -->
                    <a><i class="fa-brands fa-instagram"></i></a>
                    <a><i class="fa-brands fa-facebook"></i></a>
                    <a><i class="fa-brands fa-youtube"></i></a>
                    <a><i class="fa-brands fa-tiktok"></i></a>
                </div>
            </div>
            <div class="footer-column">
                <a href="#">Aviso legal</a>
                <a href="#">Política de privacidad</a>
                <a href="#">Términos y condiciones</a>
                <a href="http://creativecommons.org/licenses/by-nd/4.0/?ref=chooser-v1" target="_blank"
                    rel="license noopener noreferrer" style="display:inline-block;">CC BY-ND 4.0<img
                        style="height:22px!important;margin-left:3px;vertical-align:text-bottom;"
                        src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1"
                        alt="licencia"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;"
                        src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1"
                        alt="licencia"><img style="height:22px!important;margin-left:3px;vertical-align:text-bottom;"
                        src="https://mirrors.creativecommons.org/presskit/icons/nd.svg?ref=chooser-v1"
                        alt="licencia"></a>
            </div>
        </div>
    </footer>
</body>

</html>